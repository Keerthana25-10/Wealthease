<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<title>Smart Expense Tracker</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Didact+Gothic&display=swap');
  body {
    margin: 0;
    font-family: 'Didact Gothic', sans-serif;
    background-color: #000;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 20px;
  }
  header {
    background-color: #d6f7f7;
    width: 90vw;
    max-width: 1000px;
    padding: 10px 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    border-radius: 5px;
  }
  header h1 {
    font-weight: 400;
    font-size: 2rem;
    letter-spacing: 2px;
    margin: 0;
  }
  main {
    background: white;
    width: 90vw;
    max-width: 1000px;
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 15px;
    padding: 15px;
    border-radius: 8px;
  }
  #left-panel {
    display: flex;
    flex-direction: column;
    gap: 15px;
  }
  #add-expense {
    background: #c3f1ee;
    padding: 15px;
    border-radius: 8px;
  }
  #add-expense h3,
  #daily-expenses h3,
  .chart-title {
    font-weight: bold;
    text-align: center;
    margin-bottom: 10px;
    color: #333;
  }
  #add-expense label {
    display: block;
    margin-bottom: 5px;
    font-size: 0.9rem;
  }
  #add-expense input,
  #add-expense select {
    width: 100%;
    padding: 8px;
    margin-bottom: 10px;
    border: none;
    border-radius: 6px;
    background: #eaeaea;
  }
  #add-expense button {
    width: 100%;
    background: #ea93ff;
    border: none;
    padding: 10px;
    border-radius: 6px;
    color: white;
    font-weight: bold;
    cursor: pointer;
  }
  #add-expense button:hover {
    background: #c168cc;
  }
  #daily-expenses {
    background: #d5f4f0;
    padding: 15px;
    border-radius: 8px;
    height: 250px;
    overflow-y: auto;
  }
  .expense-item {
    background: white;
    padding: 6px 8px;
    margin-bottom: 6px;
    border-radius: 6px;
    font-size: 0.9rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  .expense-actions button {
    margin-left: 5px;
    background: #ea93ff;
    border: none;
    padding: 5px 8px;
    border-radius: 4px;
    cursor: pointer;
    color: white;
    font-size: 0.75rem;
  }
  #right-panel {
    background: #fff;
    border-radius: 8px;
    padding: 15px;
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  .chart-title {
    color: #4a4a9d;
    font-size: 1.2rem;
    margin-bottom: 10px;
  }
  #chart-filter {
    margin-bottom: 10px;
    text-align: center;
  }
  #chart-filter select {
    padding: 6px 12px;
    border-radius: 6px;
    border: none;
    font-size: 1rem;
    cursor: pointer;
  }
  h4 {
    margin-top: 15px;
    margin-bottom: 5px;
    text-align: center;
  }
  /* ✅ Limits Panel styled as a card */
  #limits-panel {
    background: #fff;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    margin-top: 10px;
  }
  #limits-panel h3 {
    margin-top: 0;
    color: #4a4a9d;
    text-align: center;
  }
  #limits-panel label {
    display: block;
    margin: 10px 0 5px;
    font-weight: bold;
  }
  #limits-panel select {
    width: 100%;
    padding: 8px;
    margin-bottom: 10px;
    border: none;
    border-radius: 6px;
    background: #eaeaea;
  }
  #limits-panel button {
    width: 100%;
    padding: 10px;
    border: none;
    border-radius: 8px;
    font-weight: bold;
    cursor: pointer;
    margin-top: 8px;
  }
  #save-limits-btn {
    background: #4a90e2;
    color: white;
    transition: background 0.3s, transform 0.2s;
  }
  #save-limits-btn:hover {
    background: #357ABD;
    transform: translateY(-2px);
  }
  #limits-panel button:last-child {
    background: #ea93ff;
    color: white;
    transition: background 0.3s, transform 0.2s;
  }
  #limits-panel button:last-child:hover {
    background: #c168cc;
    transform: translateY(-2px);
  }
  /* ✅ Interactive Login Card */
  .login-card {
    background: linear-gradient(135deg, #a8edea, #fed6e3);
    padding: 30px;
    border-radius: 12px;
    text-align: center;
    max-width: 350px;
    width: 100%;
    margin-bottom: 20px;
    box-shadow: 0 8px 20px rgba(0,0,0,0.15);
    animation: fadeIn 0.8s ease-in-out;
  }
  .login-card h2 {
    margin: 0 0 10px;
    color: #333;
    font-weight: 600;
  }
  .login-card p {
    margin-bottom: 15px;
    color: #555;
  }
  .login-card input {
    width: 100%;
    padding: 12px 15px;
    border: none;
    border-radius: 8px;
    margin-bottom: 15px;
    font-size: 1rem;
    outline: none;
    transition: box-shadow 0.3s ease;
  }
  .login-card input:focus {
    box-shadow: 0 0 0 3px rgba(74,144,226,0.4);
  }
  .login-card button {
    width: 100%;
    padding: 12px;
    border: none;
    border-radius: 8px;
    font-size: 1rem;
    font-weight: bold;
    background: #4a90e2;
    color: white;
    cursor: pointer;
    transition: transform 0.2s, background 0.3s;
  }
  .login-card button:hover {
    background: #357ABD;
    transform: translateY(-2px);
  }
  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(-10px); }
    to { opacity: 1; transform: translateY(0); }
  }
</style>
</head>
<body>
<header>
  <h1>SMART EXPENSE TRACKER</h1>
  <img alt="expense icon" src="https://cdn-icons-png.flaticon.com/512/2838/2838912.png" width="40"/>
</header>

<!-- ✅ Interactive Login Panel -->
<div id="login-panel" class="login-card">
  <h2>Welcome Back 👋</h2>
  <p>Please enter your username to continue</p>
  <input id="username" type="text" placeholder="Enter your name"/>
  <button id="login-btn">Login</button>
</div>

<main style="display:none;" id="app-main">
  <!-- Left Panel -->
  <section id="left-panel">
    <div id="add-expense">
      <h3>Add New Expense:</h3>
      <label for="expense-name">Expense Name:</label>
      <input id="expense-name" type="text"/>
      <label for="expense-amount">Amount:</label>
      <input id="expense-amount" type="number" step="0.01"/>
      <label for="expense-category">Category:</label>
      <select id="expense-category">
        <option value="Food">Food</option>
        <option value="Transport">Transport</option>
        <option value="Entertainment">Entertainment</option>
        <option value="Bills">Bills</option>
        <option value="Other">Other</option>
      </select>
      <label for="expense-date">Date:</label>
      <input id="expense-date" type="date"/>
      <label for="currency">Currency:</label>
      <select id="currency">
        <option selected value="USD">USD ($)</option>
        <option value="EUR">EUR (€)</option>
        <option value="GBP">GBP (£)</option>
        <option value="INR">INR (₹)</option>
        <option value="JPY">JPY (¥)</option>
      </select>
      
<label for="receipt-upload">Scan Receipt:</label>
<input type="file" id="receipt-upload" accept="image/*"/>
<button id="scan-receipt-btn" type="button">Scan Receipt</button>
<p id="scan-status" style="font-size:0.8rem; color:gray;"></p>
<div id="scan-preview" style="display:none; background:#f1f1f1; padding:10px; border-radius:6px; margin-top:8px; font-size:0.9rem;">
  <strong>Scan Results:</strong>
  <p id="preview-store"></p>
  <p id="preview-amount"></p>
  <p id="preview-date"></p>
  <p id="preview-currency"></p>
  <label for="preview-category-select">Category:</label>
  <select id="preview-category-select" style="margin-left:5px; padding:3px; border-radius:4px;">
    <option value="Food">Food</option>
    <option value="Transport">Transport</option>
    <option value="Entertainment">Entertainment</option>
    <option value="Bills">Bills</option>
    <option value="Other">Other</option>
  </select>
  <p id="preview-detected-line" style="font-style:italic; color:#555;"></p>
  <button id="use-scan-btn" type="button" style="margin-top:5px; background:#4a90e2; color:white; border:none; padding:6px 10px; border-radius:4px; cursor:pointer;">Use Data</button>
</div>


      <button id="add-expense-btn">ADD EXPENSE</button>
    </div>

    <div id="daily-expenses">
      <h3>DAILY EXPENSES:</h3>
      <div id="expenses-list"></div>
    </div>

    <!-- ✅ Styled Limits Panel -->
    <div id="limits-panel">
      <h3>Set Limits</h3>
      <label for="monthly-limit">Monthly Limit:</label>
      <select id="monthly-limit">
        <option value="0">No Limit</option>
        <option value="500">500</option>
        <option value="1000">1000</option>
        <option value="2000">2000</option>
        <option value="5000">5000</option>
      </select>

      <label for="weekly-limit">Weekly Limit:</label>
      <select id="weekly-limit">
        <option value="0">No Limit</option>
        <option value="100">100</option>
        <option value="250">250</option>
        <option value="500">500</option>
        <option value="1000">1000</option>
      </select>

      <button id="save-limits-btn">Save Limits</button>
      <button onclick="window.location.href='expensesummary.html'">Go to Summary</button>
    </div>
  </section>

  <!-- Right Panel -->
  <section id="right-panel">
    <h3 class="chart-title">Expense Distribution</h3>
    <div id="chart-filter">
      <label for="month-select">Choose Month:</label>
      <select id="month-select"><option value="all">All</option></select>
    </div>
    <div id="charts-wrapper"></div>
  </section>
</main>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const categories = ['Food', 'Transport', 'Entertainment', 'Bills', 'Other'];
  let expenses = [];
  let charts = [];
  let currentUser = null;

  const expensesList = document.getElementById('expenses-list');
  const monthSelect = document.getElementById("month-select");
  const chartsWrapper = document.getElementById("charts-wrapper");

  function getCurrencySymbol(currency) {
    const symbols = { USD: '$', EUR: '€', GBP: '£', INR: '₹', JPY: '¥' };
    return symbols[currency] || currency + ' ';
  }

  function saveExpenses() {
    if (!currentUser) return;
    localStorage.setItem(`expenses_${currentUser}`, JSON.stringify(expenses));
    localStorage.setItem("username", currentUser);
  }

  function loadExpenses() {
    if (!currentUser) return;
    expenses = JSON.parse(localStorage.getItem(`expenses_${currentUser}`)) || [];
  }

  function updateExpensesDisplay() {
    expensesList.innerHTML = '';
    if (expenses.length === 0) {
      expensesList.innerHTML = '<p>No expenses yet.</p>';
      return;
    }
    expenses.forEach(expense => {
      const div = document.createElement('div');
      div.classList.add('expense-item');
      div.innerHTML = `
        <span>${expense.date} - ${expense.name} (${expense.category}): ${getCurrencySymbol(expense.currency)}${expense.amount.toFixed(2)}</span>
        <span class="expense-actions">
          <button onclick="deleteExpense(${expense.id})">Delete</button>
        </span>
      `;
      expensesList.appendChild(div);
    });
  }

  function updateMonthOptions() {
    const months = [...new Set(expenses.map(e => e.date.slice(0,7)))];
    monthSelect.innerHTML = `<option value="all">All</option>` + 
      months.map(m => `<option value="${m}">${m}</option>`).join("");
  }

  function updateChartsByMonth(filter = "all") {
    charts.forEach(c => c.destroy());
    charts = [];
    chartsWrapper.innerHTML = "";

    if (expenses.length === 0) {
      chartsWrapper.innerHTML = "<p>No expenses yet.</p>";
      return;
    }

    const monthlyData = {};
    for (const expense of expenses) {
      const month = expense.date.slice(0, 7);
      if (!monthlyData[month]) {
        monthlyData[month] = { Food: 0, Transport: 0, Entertainment: 0, Bills: 0, Other: 0 };
      }
      monthlyData[month][expense.category] += expense.amount;
    }

    Object.entries(monthlyData).forEach(([month, sums]) => {
      if (filter !== "all" && filter !== month) return;

      const canvas = document.createElement("canvas");
      const title = document.createElement("h4");
      title.textContent = month;

      chartsWrapper.appendChild(title);
      chartsWrapper.appendChild(canvas);

      const chart = new Chart(canvas.getContext("2d"), {
        type: "doughnut",
        data: {
          labels: categories,
          datasets: [{
            data: categories.map(cat => sums[cat]),
            backgroundColor: ['#ff6384', '#3a9bdc', '#f3ca74', '#6bc5b6', '#8a72e6']
          }]
        },
        options: { responsive: true, plugins: { legend: { position: "bottom" } } }
      });
      charts.push(chart);
    });
  }

  monthSelect.addEventListener("change", e => {
    updateChartsByMonth(e.target.value);
  });

  document.getElementById("add-expense-btn").addEventListener("click", () => {
    const name = document.getElementById("expense-name").value.trim();
    const amount = parseFloat(document.getElementById("expense-amount").value);
    const category = document.getElementById("expense-category").value;
    const date = document.getElementById("expense-date").value || new Date().toISOString().slice(0,10);
    const currency = document.getElementById("currency").value;
    if (!name || isNaN(amount) || amount <= 0) {
      alert("Enter valid expense details.");
      return;
    }
    expenses.push({ id: Date.now(), name, amount, category, date, currency });
    saveExpenses();
    updateExpensesDisplay();
    updateMonthOptions();
    updateChartsByMonth(monthSelect.value);
    document.getElementById("expense-name").value = "";
    document.getElementById("expense-amount").value = "";
  });

  function deleteExpense(id) {
    expenses = expenses.filter(e => e.id !== id);
    saveExpenses();
    updateExpensesDisplay();
    updateMonthOptions();
    updateChartsByMonth(monthSelect.value);
  }

  document.getElementById("save-limits-btn").addEventListener("click", () => {
    if (!currentUser) {
      alert("Please log in first!");
      return;
    }
    const monthlyLimit = document.getElementById("monthly-limit").value;
    const weeklyLimit = document.getElementById("weekly-limit").value;
    localStorage.setItem(`monthlyLimit_${currentUser}`, monthlyLimit);
    localStorage.setItem(`weeklyLimit_${currentUser}`, weeklyLimit);
    localStorage.setItem("username", currentUser);
    alert("Limits saved successfully!");
  });

  // Login
  document.getElementById("login-btn").addEventListener("click", () => {
    const username = document.getElementById("username").value.trim();
    if (!username) {
      alert("Please enter a username");
      return;
    }
    currentUser = username;
    loadExpenses();
    updateExpensesDisplay();
    updateMonthOptions();
    updateChartsByMonth();
    document.getElementById("login-panel").style.display = "none";
    document.getElementById("app-main").style.display = "grid";
  });
</script>









<script src="https://cdn.jsdelivr.net/npm/tesseract.js@2.1.5/dist/tesseract.min.js"></script>
<script>
  document.getElementById("scan-receipt-btn").addEventListener("click", () => {
    const fileInput = document.getElementById("receipt-upload");
    const statusEl = document.getElementById("scan-status");

    if (!fileInput.files.length) {
      alert("Please upload a receipt image first.");
      return;
    }

    // Reset fields before scanning
    document.getElementById("expense-name").value = "";
    document.getElementById("expense-amount").value = "";
    document.getElementById("expense-date").value = "";
    document.getElementById("currency").value = "USD";
    document.getElementById("scan-preview").style.display = "none";

    const file = fileInput.files[0];
    statusEl.textContent = "Scanning receipt... Please wait ⏳";

    Tesseract.recognize(file, 'eng')
      .then(({ data: { text } }) => {
        statusEl.textContent = "Scan complete ✅";
        console.log("Receipt OCR Text:", text);

        // --- Extract Store Name (use first line of text)
        const lines = text.split("\n").map(l => l.trim()).filter(l => l.length > 0);
        let storeName = lines.length > 0 ? lines[0] : "Receipt Item";

        // --- Extract Amount (line-based detection with context)
        let amount = null;
        let detectedLine = "Not found";

        const keywords = /(total|grand\s*total|amount\s*due|sum|varekjøp)/i;
        for (let line of lines) {
          if (keywords.test(line)) {
            let numMatch = line.match(/(\d+[\.,]\d{2})/);
            if (numMatch) {
              amount = parseFloat(numMatch[1].replace(",", "."));
              detectedLine = line;
              break;
            }
          }
        }

        if (!amount) {
          let currencyMatch = text.match(/(NOK|USD|EUR|GBP|INR|JPY|kr)\s*(\d+[\.,]\d{2})/i);
          if (currencyMatch) {
            amount = parseFloat(currencyMatch[2].replace(",", "."));
            detectedLine = currencyMatch[0];
          }
        }

        if (!amount) {
          const allNumbers = text.match(/\d+[\.,]\d{2}/g);
          if (allNumbers) {
            const numericValues = allNumbers
              .map(n => parseFloat(n.replace(",", ".")))
              .filter(v => v > 1 && v < 10000 && v != 2023 && v != 2024);
            if (numericValues.length > 0) {
              amount = Math.max(...numericValues);
              detectedLine = "Fallback (largest number: " + amount + ")";
            }
          }
        }

        // --- Extract Date (common formats)
        const dateRegex = /(\d{4}[-/]\d{2}[-/]\d{2}|\d{2}[-/]\d{2}[-/]\d{4})/;
        const dateMatch = text.match(dateRegex);
        let date = dateMatch ? dateMatch[0] : "";

        // --- Detect Currency Symbol/Text
        let currency = "USD"; // default
        if (text.includes("€")) currency = "EUR";
        else if (text.includes("£")) currency = "GBP";
        else if (text.includes("₹")) currency = "INR";
        else if (text.includes("¥")) currency = "JPY";
        else if (text.match(/NOK|kr/i)) currency = "NOK";

        // --- Suggest Category
        let category = "Other";
        const lowerText = text.toLowerCase();
        if (/(pizza|restaurant|cafe|burger|mcdonald|kfc|food|grocery)/.test(lowerText)) {
          category = "Food";
        } else if (/(taxi|uber|bus|train|flight|fuel|petrol|transport)/.test(lowerText)) {
          category = "Transport";
        } else if (/(netflix|cinema|movie|spotify|concert|entertainment)/.test(lowerText)) {
          category = "Entertainment";
        } else if (/(electricity|gas|water|internet|phone|bill)/.test(lowerText)) {
          category = "Bills";
        }

        // --- Show preview
        document.getElementById("preview-store").textContent = "Store: " + storeName;
        document.getElementById("preview-amount").textContent = "Amount: " + (amount ? amount.toFixed(2) : "Not found");
        document.getElementById("preview-date").textContent = "Date: " + (date || "Not found");
        document.getElementById("preview-currency").textContent = "Currency: " + currency;
        document.getElementById("preview-detected-line").textContent = "Detected from: " + detectedLine;
        document.getElementById("scan-preview").style.display = "block";

        // Preselect suggested category in dropdown
        document.getElementById("preview-category-select").value = category;

        // --- Apply values when user confirms
        document.getElementById("use-scan-btn").onclick = () => {
          document.getElementById("expense-name").value = storeName;
          if (amount) document.getElementById("expense-amount").value = amount.toFixed(2);
          if (date) {
            if (/^\d{2}[-/]\d{2}[-/]\d{4}$/.test(date)) {
              const [d, m, y] = date.split(/[-/]/);
              date = `${y}-${m}-${d}`;
            }
            document.getElementById("expense-date").value = date;
          }
          document.getElementById("currency").value = currency;
          document.getElementById("expense-category").value = document.getElementById("preview-category-select").value;
          alert("Data applied to form! Now click 'ADD EXPENSE'.");
        };
      })
      .catch(err => {
        console.error(err);
        statusEl.textContent = "Error scanning receipt ❌";
      });
  });
</script>









</body>
</html>